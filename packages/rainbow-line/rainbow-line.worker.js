/*!
@file rainbow-line - A custom element that displays a cut line animated with rainbow colors
@author Wolfger Schramm <wolfger@spearwolf.de>
@version 0.2.0+vanilla.20240228

Copyright 2024 Wolfger Schramm

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

*/
var pe=Object.defineProperty,me=(e,t,i)=>t in e?pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,f=(e,t,i)=>(me(e,typeof t!="symbol"?t+"":t,i),i),ye=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},ve=(e,t,i)=>(ye(e,t,"read from private field"),i?i.call(e):t.get(e)),Ee=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},I={Max:Number.POSITIVE_INFINITY,AAA:1e9,BB:1e6,C:1e3,Default:0,Low:-1e4,Min:Number.NEGATIVE_INFINITY},u="*",J=1,P=2,k=4,X=(Symbol.eventize||(Symbol.eventize=Symbol("eventize")),Symbol.eventize),ge="[eventize]",x=e=>e===u,Z=e=>{switch(typeof e){case"string":case"symbol":return!0;default:return!1}},V=typeof console<"u",Ae=V?console[console.warn?"warn":"log"].bind(console,ge):()=>{},be=(e,t,i)=>(Object.defineProperty(e,t,{value:i,configurable:!0}),e),Ce=0,ee=class{constructor(){f(this,"events",new Map),f(this,"eventNames",new Set)}static publish(e){e.sort((t,i)=>t.order-i.order).forEach(t=>t.emit())}add(e){Array.isArray(e)?e.forEach(t=>this.eventNames.add(t)):this.eventNames.add(e)}remove(e){Array.isArray(e)?e.forEach(t=>this.eventNames.delete(t)):this.eventNames.delete(e),this.clear(e)}clear(e){Array.isArray(e)?e.forEach(t=>this.events.delete(t)):this.events.delete(e)}retain(e,t){this.eventNames.has(e)&&this.events.set(e,{args:t,order:Ce++})}isKnown(e){return this.eventNames.has(e)}emit(e,t,i=[]){if(x(e))this.eventNames.forEach(s=>this.emit(s,t,i));else if(this.events.has(e)){let{order:s,args:o}=this.events.get(e);i.push({order:s,emit:()=>t.apply(e,o)})}return i}},T=(e,t,i,s)=>{if(typeof t=="function"){let o=t.apply(e,i);o!=null&&s?.(o)}},Se=(e,t,i,s)=>T(t,t.emit,[e].concat(i),s),xe=e=>{switch(typeof e){case"function":return J;case"string":case"symbol":return P;case"object":return k}},Le=0,we=()=>++Le,te=class{constructor(e,t,i,s=null){f(this,"id"),f(this,"eventName"),f(this,"isCatchEmAll"),f(this,"priority"),f(this,"listener"),f(this,"listenerObject"),f(this,"listenerType"),f(this,"callAfterApply"),f(this,"isRemoved"),f(this,"refCount"),this.id=we(),this.eventName=e,this.isCatchEmAll=x(e),this.listener=i,this.listenerObject=s,this.priority=t,this.listenerType=xe(i),this.callAfterApply=void 0,this.isRemoved=!1,this.refCount=1}isEqual(e,t=null){if(e===this)return!0;let i=typeof e;return i==="number"&&e===this.id?!0:t===null&&(i==="string"||i==="symbol")?e===u||e===this.eventName:this.listener===e&&this.listenerObject===t}apply(e,t,i){if(this.isRemoved)return;let{listener:s,listenerObject:o}=this;switch(this.listenerType){case J:T(o,s,t,i),this.callAfterApply&&this.callAfterApply();break;case P:T(o,o[s],t,i),this.callAfterApply&&this.callAfterApply();break;case k:{let l=s[e];if(this.isCatchEmAll||this.eventName===e){if(typeof l=="function"){let r=l.apply(s,t);r!=null&&i?.(r)}else Se(e,s,t,i);this.callAfterApply&&this.callAfterApply()}break}}}},Fe=(e,t)=>e.priority!==t.priority?t.priority-e.priority:e.id-t.id,G=e=>e?.slice(0),j=(e,t)=>{let i=e.indexOf(t);i>-1&&e.splice(i,1)},ze=e=>e===k||e===P,D=(e,t,i)=>{let s=e.findIndex(o=>o.isEqual(t,i));s>-1&&(e[s].isRemoved=!0,e.splice(s,1))},C=(e,t,i)=>{let s=[];for(let o of e)(t==null&&o.listenerObject===i||o.eventName===t&&o.listener===i)&&s.push(o);for(let o of s)D(e,o,void 0)},R=e=>{e&&(e.forEach(t=>{t.isRemoved=!0}),e.length=0)},Re=(e,t)=>e.listenerType===t.listenerType?e.priority===t.priority&&e.eventName===t.eventName&&e.listenerObject===t.listenerObject&&e.listener===t.listener:!1,Ie=(e,t)=>{if(ze(e.listenerType))return t.find(i=>Re(e,i))},Te=(e,t)=>{let i=Ie(e,t);return i?(i.refCount+=1,i):(t.push(e),t.sort(Fe),e)},O,De=class{constructor(){f(this,"namedListeners"),f(this,"catchEmAllListeners"),Ee(this,O,e=>{let t=this.namedListeners.get(e);return t||(t=[],this.namedListeners.set(e,t)),t}),this.namedListeners=new Map,this.catchEmAllListeners=[]}add(e){return Te(e,e.isCatchEmAll?this.catchEmAllListeners:ve(this,O).call(this,e.eventName))}remove(e,t,i=!1){t==null&&Array.isArray(e)?e.forEach(s=>this.remove(s,null,i)):e==null||t==null&&x(e)?this.removeAllListeners():t==null&&Z(e)?R(this.namedListeners.get(e)):e instanceof te?e.isRemoved||(e.refCount-=1,e.refCount<1&&(e.isRemoved=!0,this.namedListeners.forEach(s=>j(s,e)),j(this.catchEmAllListeners,e))):i?x(e)?C(this.catchEmAllListeners,u,e):this.namedListeners.forEach(s=>C(s,e,t)):(this.namedListeners.forEach(s=>{D(s,e,t),C(s,void 0,e)}),D(this.catchEmAllListeners,e,t),C(this.catchEmAllListeners,void 0,e))}removeAllListeners(){this.namedListeners.forEach(e=>R(e)),this.namedListeners.clear(),R(this.catchEmAllListeners)}forEach(e,t){let i=G(this.catchEmAllListeners),s=G(this.namedListeners.get(e));if(e===u||!s||s.length===0)i.forEach(t);else if(i.length===0)s.forEach(t);else{let o=s.length,l=i.length,r=0,n=0;for(;r<o||n<l;){if(r<o){let c=s[r];if(n>=l||c.priority>=i[n].priority){t(c),++r;continue}}n<l&&(t(i[n]),++n)}}}getSubscriptionCount(){let e=this.catchEmAllListeners.length;for(let t of this.namedListeners.values())e+=t.length;return e}};O=new WeakMap;var ie=e=>!!(e&&e[X]),Oe=(e,t,i,s,o,l,r)=>{let n=e.add(new te(i,s,o,l));return t.emit(i,n,r),n},Pe=(e,t,i,s)=>{let o=i.length,l=typeof i[0],r,n,c,a;if(o>=2&&o<=3&&l==="number"?(r=u,[n,c,a]=i):o>=3&&o<=4&&typeof i[1]=="number"?[r,n,c,a]=i:(n=I.Default,l==="string"||l==="symbol"||Array.isArray(i[0])?[r,c,a]=i:(r=u,[c,a]=i)),!c&&V)throw Ae("called with insufficient arguments!",i),"subscribeTo() called with insufficient arguments!";let h=y=>de=>Oe(e,t,de,y,c,a,s);return Array.isArray(r)?r.map(y=>Array.isArray(y)?h(y[1])(y[0]):h(n)(y)):h(n)(r)},U=(e,t,i)=>{let s=[],o=Pe(e,t,i,s);return ee.publish(s),o},K=e=>t=>{t.callAfterApply=()=>{e?.()}},Y=(e,t)=>Object.assign(()=>e.off(t),Array.isArray(t)?{listeners:t}:{listener:t});function S(e){if(ie(e))return e;let t=new De,i=new ee;be(e,X,{keeper:i,store:t});let s=r=>{let n=U(t,i,r),c=Y(l,n),a=!1,h=()=>{a||(c(),a=!0)};return Array.isArray(n)?n.forEach(K(h)):K(h)(n),h},o=(r,n,c)=>{Array.isArray(r)?r.forEach(a=>{t.forEach(a,h=>h.apply(a,n,c)),i.retain(a,n)}):r!==u&&(t.forEach(r,a=>{a.apply(r,n,c)}),i.retain(r,n))},l=Object.assign(e,{on(...r){return Y(l,U(t,i,r))},once(...r){return s(r)},onceAsync(r){return new Promise(n=>{s([r,n])})},off(r,n){let c=typeof r,a=n!=null&&(c==="string"||c==="symbol");t.remove(r,n,a),Array.isArray(r)?i.remove(r.filter(h=>typeof h=="string")):Z(r)&&i.remove(r)},emit(r,...n){o(r,n)},emitAsync(r,...n){let c=[];return o(r,n,a=>{c.push(a)}),c=c.map(a=>Array.isArray(a)?Promise.all(a):Promise.resolve(a)),c.length>0?Promise.all(c):Promise.resolve()},retain(r){i.add(r)},retainClear(r){i.clear(r)}});return l}var v=(()=>{let e=(t={})=>S(t);return e.inject=S,e.extend=t=>S(Object.create(t)),e.create=t=>{let i=S({});return i.on(u,I.Default,t),i},e.is=ie,e.Priority=I,e})();var E=class{#e;#t;constructor(t="id",i=1){this.#e=t,this.#t=i}make(){return Symbol(`${this.#e}${this.#t++}`)}};var ke=0;function re(){return ke>0}var L=Symbol("signal"),_=Symbol("destroySignal"),M=Symbol("createEffect"),se=Symbol("destroyEffect");var g=v({}),w=v({}),d=v({});var m=class{static current;#e=new Set;batch(t){this.#e.add(t)}run(){d.emit(Array.from(this.#e))}},ne=()=>m.current;function Q(e){let t=m.current;t?t=void 0:t=m.current=new m;try{e()}finally{t&&(m.current=void 0,t.run())}}var W=[],F=()=>W.at(-1),oe=(e,t)=>{W.push(e);try{return t()}finally{W.pop()}};var _e=e=>e!=null&&typeof e.then=="function",z=class e{static idGen=new E("ef");static count=0;id;callback;#e;#t=new Set;#i=new Set;parentEffect;childEffects=[];curChildEffectSlot=0;autorun=!0;shouldRun=!0;#r;#s=!1;constructor(t,i){this.callback=t,this.autorun=i?.autorun??!0,this.#r=i?.dependencies,this.id=e.idGen.make(),d.on(this.id,"recall",this),++e.count}hasStaticDeps(){return this.#r!=null&&this.#r.length>0}saveSignalsFromDeps(){for(let t of this.#r)this.whenSignalIsRead(N(t).id)}static createEffect(t,i,s){let o=Array.isArray(i)?i:void 0,l=o?s??{dependencies:o}:i;l&&o&&(l.dependencies=o);let r,n=F();return n!=null?(r=n.getCurrentChildEffect(),r==null&&(r=new e(t,l),n.attachChildEffect(r),d.emit(M,r)),n.curChildEffectSlot++):(r=new e(t,l),d.emit(M,r)),r.hasStaticDeps()?r.saveSignalsFromDeps():r.autorun&&r.run(),[r.run.bind(r),r.destroy.bind(r)]}getCurrentChildEffect(){return this.childEffects[this.curChildEffectSlot]}attachChildEffect(t){this.childEffects.push(t),this.parentEffect=this}run(){if(this.#s||!this.shouldRun)return;let t=ne();t?t.batch(this.id):(this.runCleanupCallback(),this.curChildEffectSlot=0,this.shouldRun=!1,this.hasStaticDeps()?this.#e=this.callback():this.#e=oe(this,this.callback))}recall(){this.shouldRun=!0,this.autorun&&this.run()}whenSignalIsRead(t){this.#t.has(t)||(this.#t.add(t),g.on(t,"recall",this),w.once(t,_,this))}[_](t){!this.#i.has(t)&&this.#t.has(t)&&(this.#i.add(t),g.off(t,this),this.#i.size===this.#t.size&&this.destroy())}runCleanupCallback(){if(this.#e!=null){let t=this.#e;this.#e=void 0,_e(t)?Promise.resolve(t).then(i=>{typeof i=="function"&&i()}):t()}}destroy(){this.#s||(d.emit(se,this),this.runCleanupCallback(),g.off(this),d.off(this),w.off(this),this.#s=!0,this.#t.clear(),this.#i.clear(),this.childEffects.forEach(t=>{t.destroy()}),this.childEffects.length=0,--e.count)}};var A=(...e)=>z.createEffect(...e);var Me=new E("si");function ae(e){re()||F()?.whenSignalIsRead(e)}function ce(e,t,i){g.emit(e,t,i)}var Qe=e=>typeof e=="function"&&L in e,We=e=>{let t=i=>(i?A(()=>(e.destroyed||ae(e.id),i(e.value)),[t]):e.destroyed||(e.beforeReadFn?.(),ae(e.id)),e.value);return Object.defineProperty(t,L,{value:e}),t},$=class e{static instanceCount=0;id;lazy;compareFn;beforeReadFn;muted=!1;destroyed=!1;#e=void 0;get value(){return this.lazy&&(this.#e=this.valueFn(),this.valueFn=void 0,this.lazy=!1),this.#e}set value(t){this.#e=t}valueFn;reader;writer=(t,i)=>{let s=i?.lazy??!1,l=i?.compareFn??this.compareFn??((n,c)=>n===c);if((s!==this.lazy||s&&t!==this.valueFn||!s&&!l(t,this.#e))&&(s?(this.#e=void 0,this.valueFn=t,this.lazy=!0):(this.#e=t,this.valueFn=void 0,this.lazy=!1),!this.muted&&!this.destroyed)){ce(this.id,this.#e);return}(i?.touch??!1)&&ce(this.id,this.#e,{touch:!0})};constructor(t,i){this.id=Me.make(),++e.instanceCount,this.lazy=t,this.lazy?(this.value=void 0,this.valueFn=i):(this.value=i,this.valueFn=void 0),this.reader=We(this)}},N=e=>e?.[L];function b(e=void 0,t){let i;if(Qe(e))i=N(e);else{let s=t?.lazy??!1;i=new $(s,e),i.beforeReadFn=t?.beforeReadFn,i.compareFn=t?.compareFn}return[i.reader,i.writer]}var le=class p{static Canvas="onCanvas";static Init="onInit";static Resize="onResize";static Frame="onFrame";get ready(){return this.canvas&&this.isConnected}#e=0;#t=void 0;constructor(){v(this);let[t,i]=b(null),[s,o]=b(!1),[l,r]=b(0),[n,c]=b(0);Object.defineProperties(this,{canvas:{get:()=>t(),set:a=>{i(a)},enumerable:!0},isConnected:{get:()=>s(),set:a=>{o(a)},enumerable:!0},canvasWidth:{get:()=>l(),set:a=>{r(a)},enumerable:!0},canvasHeight:{get:()=>n(),set:a=>{c(a)},enumerable:!0}}),this.now=0,this.retain([p.Canvas,p.Init,p.Resize]),A(()=>{this.canvas&&this.emit(p.Canvas,this,this.#t)},[t]),A(()=>{this.ready&&this.emit(p.Init,this)},[t,s]),A(()=>{this.emit(p.Resize,this)},[l,n])}#i(){this.#e=requestAnimationFrame(t=>this.#s(t))}#r(){cancelAnimationFrame(this.#e)}#s(t){this.ready&&(Q(()=>{this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height}),this.now=t/1e3,this.canvasWidth>0&&this.canvasHeight>0&&this.emit(p.Frame,this)),this.#i()}parseMessageData(t){t&&(t.canvas&&(this.#t=t.contextAttributes||void 0,this.canvas=t.canvas),t.isConnected&&this.isConnected!==t.isConnected&&(this.isConnected=t.isConnected,this.isConnected?this.#i():this.#r()),t.resize&&this.canvas&&(this.canvas.width=Math.floor(t.resize.width),this.canvas.height=Math.floor(t.resize.height)))}};var fe=new le,B=10,H=7,he=-1,q=null;fe.on({onCanvas({canvas:e},t){q=e.getContext("2d",t)},onFrame({now:e,canvasWidth:t,canvasHeight:i}){let s=0;for(;s<t;){let o=e%H*he*360/H;q.fillStyle=`hsl(${s/t*360+o}, 100%, 50%)`,q.fillRect(s,0,B,i),s+=B}}});function ue(e){fe.parseMessageData(e),"color-slice-width"in e&&(B=e["color-slice-width"]),"slice-cycle-time"in e&&(H=e["slice-cycle-time"]),"cycle-direction"in e&&(he=e["cycle-direction"])}self.addEventListener("message",e=>{ue(e.data)});
/*! Bundled license information:

@spearwolf/eventize/lib/index.mjs:
  (*!
  =============================================================================
  @spearwolf/eventize 3.4.1+build.20231031
  — https://github.com/spearwolf/eventize.git
  =============================================================================
  
  Copyright 2015-2023 Wolfger Schramm
  
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  
     http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  *)
*/
